"use strict";var Ve=Object.create;var R=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,Xe=Object.prototype.hasOwnProperty;var Je=(t,r)=>{for(var n in r)R(t,n,{get:r[n],enumerable:!0})},B=(t,r,n,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Ge(r))!Xe.call(t,s)&&s!==n&&R(t,s,{get:()=>r[s],enumerable:!(o=Ye(r,s))||o.enumerable});return t};var h=(t,r,n)=>(n=t!=null?Ve($e(t)):{},B(r||!t||!t.__esModule?R(n,"default",{value:t,enumerable:!0}):n,t)),Fe=t=>B(R({},"__esModule",{value:!0}),t);var lt={};Je(lt,{Account:()=>te,AccountProof:()=>w,AccountsRequestItem:()=>A,AccountsRequestResponseItem:()=>b,AuthLoginRequestItem:()=>me,AuthLoginRequestResponseItem:()=>je,AuthLoginWithChallengeRequestItem:()=>le,AuthLoginWithChallengeRequestResponseItem:()=>Se,AuthLoginWithoutChallengeRequestItem:()=>ce,AuthLoginWithoutChallengeRequestResponseItem:()=>ze,AuthRequestItem:()=>ue,AuthRequestResponseItem:()=>De,AuthUsePersonaRequestItem:()=>pe,AuthUsePersonaRequestResponseItem:()=>Ee,CancelRequest:()=>he,ExpireAfterDelay:()=>be,ExpireAtTime:()=>Ae,LoginRequestResponseItem:()=>rt,Metadata:()=>Ce,NumberOfValues:()=>se,Persona:()=>x,PersonaDataName:()=>nt,PersonaDataNameVariant:()=>N,PersonaDataRequestItem:()=>I,PersonaDataRequestResponseItem:()=>q,PersonaProof:()=>oe,Proof:()=>g,ProofOfOwnershipRequestItem:()=>ne,ProofOfOwnershipResponseItem:()=>re,RADIX_ENTITY_TYPE:()=>ee,RADIX_KEY_TYPE:()=>Z,ResetRequestItem:()=>ie,SendTransactionItem:()=>ye,SendTransactionResponseItem:()=>xe,SubintentRequestItem:()=>Ie,SubintentResponseItem:()=>qe,WalletAuthorizedRequestItems:()=>de,WalletAuthorizedRequestResponseItems:()=>we,WalletInteraction:()=>st,WalletInteractionFailureResponse:()=>Le,WalletInteractionItems:()=>Te,WalletInteractionResponse:()=>it,WalletInteractionResponseItems:()=>Oe,WalletInteractionSuccessResponse:()=>Ke,WalletPreAuthorizationItems:()=>Pe,WalletPreAuthorizationResponseItems:()=>Ue,WalletRequestItems:()=>fe,WalletRequestResponseItems:()=>Ne,WalletTransactionItems:()=>ge,WalletTransactionResponseItems:()=>Re,WalletUnauthorizedRequestItems:()=>ae,WalletUnauthorizedRequestResponseItems:()=>We,base64urlEncode:()=>O,blake2b:()=>y,concat:()=>Qe,createEd25519KeyPair:()=>z,createMessageHash:()=>K,createRadixConnectClient:()=>pt,createRadixConnectRelayApiClient:()=>M,createRadixConnectRelayTransport:()=>at,createRolaMessage:()=>ct,decrypt:()=>S,decryptPayload:()=>L,encrypt:()=>Ze,fromHex:()=>f,generateBIP39Mnemonic:()=>tt,getRadixBIP39DerivationPath:()=>et,mnemonicToPrivateKey:()=>ot,personaDataFullNameVariant:()=>D,produceSignature:()=>k,secureRandom:()=>j,toHex:()=>c,transformToSealbox:()=>U});module.exports=Fe(lt);var Qe=(...t)=>{let r=t.reduce((s,p)=>s+p.length,0),n=new Uint8Array(r),o=0;for(let s of t)n.set(s,o),o+=s.length;return n};var f=t=>{let r=t.startsWith("0x")?t.slice(2):t,n=new Uint8Array(r.length/2);for(let o=0;o<n.length;o++)n[o]=parseInt(r.slice(o*2,o*2+2),16);return n};var c=t=>Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join("");var V=h(require("blakejs"),1),y=t=>V.default.blake2bHex(t,void 0,32);var m=require("@noble/curves/ed25519"),Y=require("@noble/hashes/hkdf"),G=require("@noble/hashes/sha256"),z=(t=m.x25519.utils.randomPrivateKey())=>{let r={privateKey:t,publicKey:m.ed25519.getPublicKey(t),sign:o=>m.ed25519.sign(o,t)},n={privateKey:t,publicKey:m.x25519.getPublicKey(t),calculateSharedSecret:o=>(0,Y.hkdf)(G.sha256,m.x25519.getSharedSecret(t,o.publicKey),o.salt,o.context,o.length)};return{ed25519:r,x25519:n}};var $=require("@noble/hashes/utils"),X=t=>crypto.subtle.importKey("raw",t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),S=({data:t,encryptionKey:r,iv:n})=>X(r).then(o=>crypto.subtle.decrypt({name:"AES-GCM",iv:n},o,t)).then(o=>new Uint8Array(o)),Ze=(t,r,n=crypto.getRandomValues(new Uint8Array(12)))=>X(r).then(o=>crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,t).then(s=>new Uint8Array(s))).then(o=>({combined:(0,$.concatBytes)(n,o),iv:n,cipherText:o}));var J=require("@noble/hashes/utils"),U=(t,r)=>{let{nonceLength:n=12,authTagLength:o=16}=r??{},s=t.slice(0,n),p=t.slice(n,t.length-o),u=t.slice(t.length-o);return{iv:s,cipherText:p,authTag:u,combined:t,cipherTextAndAuthTag:(0,J.concatBytes)(p,u)}};var F=h(require("crypto"),1),j=t=>F.default.getRandomValues(new Uint8Array(t));var E=h(require("bip39"),1),Q=require("ed25519-hd-key");var Z={TRANSACTION_SIGNING:1460,AUTHENTICATION_SIGNING:1678,MESSAGE_ENCRYPTION:1391},ee={ACCOUNT:525,IDENTITY:618},et=({networkId:t,keyType:r,entityType:n,index:o=0})=>`m/44'/1022'/${t}'/${ee[n]}'/${Z[r]}'/${o}'`,tt=(t=32)=>E.default.entropyToMnemonic(c(j(t))),ot=async({mnemonic:t,password:r,derivationPath:n})=>E.default.mnemonicToSeed(t,r).then(o=>o.toString("hex")).then(o=>(0,Q.derivePath)(n,o)).then(o=>o.key.toString("hex"));var e=require("zod"),te=e.z.object({address:e.z.string(),label:e.z.string(),appearanceId:e.z.number()}),g=e.z.object({publicKey:e.z.string(),signature:e.z.string(),curve:e.z.union([e.z.literal("curve25519"),e.z.literal("secp256k1")])}),w=e.z.object({accountAddress:e.z.string(),proof:g}),oe=e.z.object({identityAddress:e.z.string(),proof:g}),ne=e.z.object({challenge:e.z.string(),identityAddress:e.z.string().optional(),accountAddresses:e.z.array(e.z.string()).optional()}),re=e.z.object({challenge:e.z.string(),proofs:e.z.array(e.z.union([w,oe]))}),x=e.z.object({identityAddress:e.z.string(),label:e.z.string()}),D={western:"western",eastern:"eastern"},N=e.z.union([e.z.literal(D.eastern),e.z.literal(D.western)]),nt=e.z.object({variant:N,familyName:e.z.string(),nickname:e.z.string(),givenNames:e.z.string()}),se=e.z.object({quantifier:e.z.union([e.z.literal("exactly"),e.z.literal("atLeast")]),quantity:e.z.number().min(0,"The number must be at least 0.")}),A=e.z.object({challenge:e.z.string().optional(),numberOfAccounts:se}),b=e.z.object({accounts:e.z.array(te),challenge:e.z.string().optional(),proofs:e.z.array(w).optional()}).refine(t=>t.challenge||t?.proofs?!!(t.challenge&&t?.proofs?.length):!0,"missing challenge or proofs"),I=e.z.object({isRequestingName:e.z.boolean().optional(),numberOfRequestedEmailAddresses:e.z.number().min(0).optional(),numberOfRequestedPhoneNumbers:e.z.number().min(0).optional()}),q=e.z.object({name:e.z.object({variant:N,familyName:e.z.string(),nickname:e.z.string(),givenNames:e.z.string()}).optional(),emailAddresses:e.z.array(e.z.string()).optional(),phoneNumbers:e.z.array(e.z.string()).optional()}),ie=e.z.object({accounts:e.z.boolean(),personaData:e.z.boolean()}),rt=e.z.object({persona:x,challenge:e.z.string().optional(),proof:g.optional()}).refine(t=>t.challenge||t.proof?!!(t.challenge&&t.proof):!0,"missing challenge or proof"),ae=e.z.object({discriminator:e.z.literal("unauthorizedRequest"),oneTimeAccounts:A.optional(),oneTimePersonaData:I.optional()}),pe=e.z.object({discriminator:e.z.literal("usePersona"),identityAddress:e.z.string()}),ce=e.z.object({discriminator:e.z.literal("loginWithoutChallenge")}),le=e.z.object({discriminator:e.z.literal("loginWithChallenge"),challenge:e.z.string()}),me=e.z.union([ce,le]),ue=e.z.union([pe,me]),de=e.z.object({discriminator:e.z.literal("authorizedRequest"),auth:ue,reset:ie.optional(),proofOfOwnership:ne.optional(),oneTimeAccounts:A.optional(),ongoingAccounts:A.optional(),oneTimePersonaData:I.optional(),ongoingPersonaData:I.optional()}),fe=e.z.union([ae,de]),ye=e.z.object({transactionManifest:e.z.string(),version:e.z.number(),blobs:e.z.array(e.z.string()).optional(),message:e.z.string().optional()}),ge=e.z.object({discriminator:e.z.literal("transaction"),send:ye}),xe=e.z.object({transactionIntentHash:e.z.string()}),Re=e.z.object({discriminator:e.z.literal("transaction"),send:xe}),he=e.z.object({discriminator:e.z.literal("cancelRequest")}),Ae=e.z.object({discriminator:e.z.literal("expireAtTime"),unixTimestampSeconds:e.z.number()}),be=e.z.object({discriminator:e.z.literal("expireAfterDelay"),expireAfterSeconds:e.z.number()}),Ie=e.z.object({discriminator:e.z.literal("subintent"),version:e.z.number(),manifestVersion:e.z.number(),subintentManifest:e.z.string(),blobs:e.z.array(e.z.string()).optional(),message:e.z.string().optional(),expiration:e.z.union([Ae,be])}),qe=e.z.object({expirationTimestamp:e.z.number(),subintentHash:e.z.string(),signedPartialTransaction:e.z.string()}),Pe=e.z.object({discriminator:e.z.literal("preAuthorizationRequest"),request:Ie.optional()}),Te=e.z.union([fe,ge,he,Pe]),Ce=e.z.object({version:e.z.literal(2),networkId:e.z.number(),dAppDefinitionAddress:e.z.string(),origin:e.z.string()}),st=e.z.object({interactionId:e.z.string(),metadata:Ce,items:Te}),We=e.z.object({discriminator:e.z.literal("unauthorizedRequest"),oneTimeAccounts:b.optional(),oneTimePersonaData:q.optional()}),ze=e.z.object({discriminator:e.z.literal("loginWithoutChallenge"),persona:x}),Se=e.z.object({discriminator:e.z.literal("loginWithChallenge"),persona:x,challenge:e.z.string(),proof:g}),Ue=e.z.object({discriminator:e.z.literal("preAuthorizationResponse"),response:qe.optional()}),je=e.z.union([ze,Se]),Ee=e.z.object({discriminator:e.z.literal("usePersona"),persona:x}),De=e.z.union([Ee,je]),we=e.z.object({discriminator:e.z.literal("authorizedRequest"),auth:De,proofOfOwnership:re.optional(),oneTimeAccounts:b.optional(),ongoingAccounts:b.optional(),oneTimePersonaData:q.optional(),ongoingPersonaData:q.optional()}),Ne=e.z.union([We,we]),Oe=e.z.union([Ne,Re,Ue]),Ke=e.z.object({discriminator:e.z.literal("success"),interactionId:e.z.string(),items:Oe}),Le=e.z.object({discriminator:e.z.literal("failure"),interactionId:e.z.string(),error:e.z.string(),message:e.z.string().optional()}),it=e.z.union([Ke,Le]);var ke=h(require("base64url"),1),O=t=>ke.default.encode(JSON.stringify(t),"utf-8");var Me=require("@noble/hashes/utils");var K=({interactionId:t,dAppDefinitionAddress:r,origin:n})=>{let o=new TextEncoder;return y((0,Me.concatBytes)(o.encode("C"),o.encode(t),new Uint8Array([r.length]),o.encode(r),o.encode(n)))};var L=async({encryptedData:t,keyPair:r,salt:n,publicKey:o})=>{let s=new TextEncoder,p=new TextDecoder,u=r.x25519.calculateSharedSecret({publicKey:o,salt:s.encode(n),context:"RCfM",length:32}),{iv:d,cipherTextAndAuthTag:P}=U(f(t)),T=await S({data:P,encryptionKey:u,iv:d}),H=p.decode(T);return JSON.parse(H)};var k=(t,r)=>{let n=K(t),o=r.ed25519.sign(n);return c(o)};var M=t=>({getResponses:n=>fetch(t.baseUrl,{method:"POST",body:JSON.stringify({method:"getResponses",sessionId:n})}).then(o=>o.json()).then(o=>o)});var at=t=>{let{baseUrl:r="https://radix-connect-relay.radixdlt.com",walletUrl:n="radixWallet://connect",sessionId:o=crypto.randomUUID(),privateKey:s,handleRequest:p}=t??{},u=M({baseUrl:`${r}/api/v1`}),d=z(s),P=i=>{let l=new URL(n);return Object.entries(i).forEach(([a,C])=>{l.searchParams.append(a,C)}),l.toString()},T=async({signal:i})=>{let l=[];for(;l.length===0;){if(i?.aborted)throw new Error("Request aborted");try{l=await u.getResponses(o)}catch(a){console.error(a)}await new Promise(a=>setTimeout(a,1e3))}return l[0]};return{sendRequest:async i=>{let a=new AbortController,C=setTimeout(()=>{a.abort("Request timed out after 5 minutes")},3e5),ve=k({dAppDefinitionAddress:i.metadata.dAppDefinitionAddress,interactionId:i.interactionId,origin:i.metadata.origin},d),v={sessionId:o,request:O(i),signature:ve,publicKey:c(d.x25519.publicKey),identity:c(d.ed25519.publicKey),origin:i.metadata.origin,dAppDefinitionAddress:i.metadata.dAppDefinitionAddress};await p({deepLink:P(v),body:v,abortController:a});let W=await T({signal:a.signal});if(clearTimeout(C),"error"in W)throw new Error(W.error);let{publicKey:_e,data:Be}=W,_=await L({encryptedData:Be,keyPair:d,salt:i.metadata.dAppDefinitionAddress,publicKey:_e});if(i.interactionId!==_.interactionId)throw new Error("Wallet interaction response does not match request");return _}}};var pt=({transport:t})=>({sendRequest:async n=>t.sendRequest(n)});var He=require("@noble/hashes/utils");var ct=({dAppDefinitionAddress:t,origin:r,challenge:n})=>{let o=new TextEncoder;return y((0,He.concatBytes)(o.encode("R"),f(n),new Uint8Array([t.length]),o.encode(t),o.encode(r)))};0&&(module.exports={Account,AccountProof,AccountsRequestItem,AccountsRequestResponseItem,AuthLoginRequestItem,AuthLoginRequestResponseItem,AuthLoginWithChallengeRequestItem,AuthLoginWithChallengeRequestResponseItem,AuthLoginWithoutChallengeRequestItem,AuthLoginWithoutChallengeRequestResponseItem,AuthRequestItem,AuthRequestResponseItem,AuthUsePersonaRequestItem,AuthUsePersonaRequestResponseItem,CancelRequest,ExpireAfterDelay,ExpireAtTime,LoginRequestResponseItem,Metadata,NumberOfValues,Persona,PersonaDataName,PersonaDataNameVariant,PersonaDataRequestItem,PersonaDataRequestResponseItem,PersonaProof,Proof,ProofOfOwnershipRequestItem,ProofOfOwnershipResponseItem,RADIX_ENTITY_TYPE,RADIX_KEY_TYPE,ResetRequestItem,SendTransactionItem,SendTransactionResponseItem,SubintentRequestItem,SubintentResponseItem,WalletAuthorizedRequestItems,WalletAuthorizedRequestResponseItems,WalletInteraction,WalletInteractionFailureResponse,WalletInteractionItems,WalletInteractionResponse,WalletInteractionResponseItems,WalletInteractionSuccessResponse,WalletPreAuthorizationItems,WalletPreAuthorizationResponseItems,WalletRequestItems,WalletRequestResponseItems,WalletTransactionItems,WalletTransactionResponseItems,WalletUnauthorizedRequestItems,WalletUnauthorizedRequestResponseItems,base64urlEncode,blake2b,concat,createEd25519KeyPair,createMessageHash,createRadixConnectClient,createRadixConnectRelayApiClient,createRadixConnectRelayTransport,createRolaMessage,decrypt,decryptPayload,encrypt,fromHex,generateBIP39Mnemonic,getRadixBIP39DerivationPath,mnemonicToPrivateKey,personaDataFullNameVariant,produceSignature,secureRandom,toHex,transformToSealbox});
